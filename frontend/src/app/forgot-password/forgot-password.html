<div class="forgot-password-container">
  <h2>Reset Password</h2>

  @if (successMessage) {
    <div class="success-message">{{ successMessage }}</div>
  }

  @if (errors['general']) {
    <div class="error-message">{{ errors['general'] }}</div>
  }

  @if (step === 'email') {
    <form (ngSubmit)="getSecurityQuestion()" #emailForm="ngForm">
      <div class="form-group">
        <label for="email">Email *</label>
        <input
          type="email"
          id="email"
          name="email"
          [(ngModel)]="email"
          (input)="onFieldChange('email')"
          required
          [class.error]="errors['email']"
        />
        @if (errors['email']) {
          <span class="error-text">{{ errors['email'] }}</span>
        }
      </div>
      <button type="submit" [disabled]="isLoading" class="submit-btn">
        {{ isLoading ? 'Loading...' : 'Continue' }}
      </button>
      <div style="margin-top: 15px; text-align: center;">
        <a routerLink="/login" style="color: #007bff; text-decoration: none;">Back to Login</a>
      </div>
    </form>
  }

  @if (step === 'question') {
    <form (ngSubmit)="verifyAnswer()" #questionForm="ngForm">
      <div class="form-group">
        <label>Security Question</label>
        <p style="background: #f5f5f5; padding: 10px; border-radius: 4px; margin-bottom: 15px;">
          {{ securityQuestion }}
        </p>
      </div>
      <div class="form-group">
        <label for="securityAnswer">Security Answer *</label>
        <input
          type="text"
          id="securityAnswer"
          name="securityAnswer"
          [(ngModel)]="securityAnswer"
          (input)="onFieldChange('securityAnswer')"
          required
          [class.error]="errors['securityAnswer']"
        />
        @if (errors['securityAnswer']) {
          <span class="error-text">{{ errors['securityAnswer'] }}</span>
        }
      </div>
      <button type="submit" [disabled]="isLoading" class="submit-btn">
        {{ isLoading ? 'Verifying...' : 'Verify Answer' }}
      </button>
      <button type="button" (click)="backToEmail()" class="btn-secondary" style="margin-left: 10px;">Back</button>
    </form>
  }

  @if (step === 'reset') {
    <form (ngSubmit)="resetPassword()" #resetForm="ngForm">
      <div class="form-group">
        <label for="newPassword">New Password *</label>
        <input
          type="password"
          id="newPassword"
          name="newPassword"
          [(ngModel)]="newPassword"
          (input)="onFieldChange('newPassword')"
          required
          [class.error]="errors['newPassword']"
        />
        @if (errors['newPassword']) {
          <span class="error-text">{{ errors['newPassword'] }}</span>
        }
      </div>
      <div class="form-group">
        <label for="confirmPassword">Confirm New Password *</label>
        <input
          type="password"
          id="confirmPassword"
          name="confirmPassword"
          [(ngModel)]="confirmPassword"
          (input)="onFieldChange('confirmPassword')"
          required
          [class.error]="errors['confirmPassword']"
        />
        @if (errors['confirmPassword']) {
          <span class="error-text">{{ errors['confirmPassword'] }}</span>
        }
      </div>
      <button type="submit" [disabled]="isLoading" class="submit-btn">
        {{ isLoading ? 'Resetting...' : 'Reset Password' }}
      </button>
      <button type="button" (click)="backToQuestion()" class="btn-secondary" style="margin-left: 10px;">Back</button>
    </form>
  }
</div>
